---
title: 适用于 Linux 的 Windows 子系统疑难解答
description: 提供有关在适用于 Linux 的 Windows 子系统上运行 Linux 时遇到的常见错误和问题的详细信息。
keywords: BashOnWindows、bash、wsl、windows、windowssubsystem、ubuntu
author: scooley
ms.author: scooley
ms.date: 11/15/2017
ms.topic: article
ms.assetid: 6753f1b2-200e-49cc-93a5-4323e1117246
ms.custom: seodec18
ms.localizationpriority: high
ms.openlocfilehash: 6a5fec8b8e054b4d3399ee9bcd903acebca7aace
ms.sourcegitcommit: 7af6b7a3f8cfa66cb25115bc26f44aa64ef22811
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/28/2019
ms.locfileid: "70122695"
---
# <a name="troubleshooting-windows-subsystem-for-linux"></a><span data-ttu-id="50732-104">适用于 Linux 的 Windows 子系统疑难解答</span><span class="sxs-lookup"><span data-stu-id="50732-104">Troubleshooting Windows Subsystem for Linux</span></span>

### <a name="bash-loses-network-connectivity-once-connected-to-a-vpn"></a><span data-ttu-id="50732-105">在连接到 VPN 后, Bash 失去网络连接</span><span class="sxs-lookup"><span data-stu-id="50732-105">Bash loses network connectivity once connected to a VPN</span></span>

<span data-ttu-id="50732-106">如果在连接到 Windows 上的 VPN 后, bash 失去网络连接, 请从 bash 内尝试此解决方法。</span><span class="sxs-lookup"><span data-stu-id="50732-106">If after connecting to a VPN on Windows, bash loses network connectivity, try this workaround from within bash.</span></span> <span data-ttu-id="50732-107">此解决方法可让你通过`/etc/resolv.conf`手动替代 DNS 解析。</span><span class="sxs-lookup"><span data-stu-id="50732-107">This workaround will allow you to manually override the DNS resolution through `/etc/resolv.conf`.</span></span>

1. <span data-ttu-id="50732-108">记下 VPN 的 DNS 服务器`ipconfig.exe /all`</span><span class="sxs-lookup"><span data-stu-id="50732-108">Take a note of the DNS server of the VPN from doing `ipconfig.exe /all`</span></span>
2. <span data-ttu-id="50732-109">创建现有 resolv.conf 的副本`sudo cp /etc/resolv.conf /etc/resolv.conf.new`</span><span class="sxs-lookup"><span data-stu-id="50732-109">Make a copy of the existing resolv.conf `sudo cp /etc/resolv.conf /etc/resolv.conf.new`</span></span>
3. <span data-ttu-id="50732-110">取消当前 resolv.conf 的链接`sudo unlink /etc/resolv.conf`</span><span class="sxs-lookup"><span data-stu-id="50732-110">Unlink the current resolv.con `sudo unlink /etc/resolv.conf`</span></span>
4. `sudo mv /etc/resolv.conf.new /etc/resolv.conf`
5. <span data-ttu-id="50732-111">打开`/etc/resolv.conf`并</span><span class="sxs-lookup"><span data-stu-id="50732-111">Open `/etc/resolv.conf` and</span></span> <br/>
   <span data-ttu-id="50732-112">a.</span><span class="sxs-lookup"><span data-stu-id="50732-112">a.</span></span> <span data-ttu-id="50732-113">删除文件中的第一行, 其中显示 "\#此文件是由 WSL 自动生成的。</span><span class="sxs-lookup"><span data-stu-id="50732-113">Delete the first line from the file, which says "\# This file was automatically generated by WSL.</span></span> <span data-ttu-id="50732-114">若要停止自动生成此文件, 请删除此行。 "。</span><span class="sxs-lookup"><span data-stu-id="50732-114">To stop automatic generation of this file, remove this line.".</span></span> <br/>
   <span data-ttu-id="50732-115">b.</span><span class="sxs-lookup"><span data-stu-id="50732-115">b.</span></span> <span data-ttu-id="50732-116">在 DNS 服务器列表中, 从 (1) 添加 DNS 条目, 作为第一个条目。</span><span class="sxs-lookup"><span data-stu-id="50732-116">Add the DNS entry from (1) above as the very first entry in the list of DNS servers.</span></span> <br/>
   <span data-ttu-id="50732-117">c.</span><span class="sxs-lookup"><span data-stu-id="50732-117">c.</span></span> <span data-ttu-id="50732-118">关闭该文件。</span><span class="sxs-lookup"><span data-stu-id="50732-118">Close the file.</span></span> <br/>

<span data-ttu-id="50732-119">断开 VPN 连接后, 必须将更改还原为`/etc/resolv.conf`。</span><span class="sxs-lookup"><span data-stu-id="50732-119">Once you have disconnected the VPN, you will have to revert the changes to `/etc/resolv.conf`.</span></span> <span data-ttu-id="50732-120">为此, 请执行以下操作:</span><span class="sxs-lookup"><span data-stu-id="50732-120">To do this, do:</span></span>
1. `cd /etc`
2. `sudo mv resolv.conf resolv.conf.new`
3. `sudo ln -s ../run/resolvconf/resolv.conf resolv.conf`

### <a name="starting-wsl-or-installing-a-distribution-returns-an-error-code"></a><span data-ttu-id="50732-121">启动 WSL 或安装分发返回了错误代码</span><span class="sxs-lookup"><span data-stu-id="50732-121">Starting WSL or installing a distribution returns an error code</span></span>

<span data-ttu-id="50732-122">按照[这些说明](https://github.com/Microsoft/WSL/blob/master/CONTRIBUTING.md#8-detailed-logs)收集 GitHub 上的详细日志并记录问题。</span><span class="sxs-lookup"><span data-stu-id="50732-122">Follow [these instructions](https://github.com/Microsoft/WSL/blob/master/CONTRIBUTING.md#8-detailed-logs) to collect detailed logs and file an issue on our GitHub.</span></span>

### <a name="updating-bash-on-ubuntu-on-windows"></a><span data-ttu-id="50732-123">在 Windows 上更新在 Ubuntu 上的 Bash</span><span class="sxs-lookup"><span data-stu-id="50732-123">Updating Bash on Ubuntu on Windows</span></span>

<span data-ttu-id="50732-124">Windows 上的 Bash 上有两个需要更新的组件。</span><span class="sxs-lookup"><span data-stu-id="50732-124">There are two components of Bash on Ubuntu on Windows that can require updating.</span></span> 

1. <span data-ttu-id="50732-125">适用于 Linux 的 Windows 子系统</span><span class="sxs-lookup"><span data-stu-id="50732-125">The Windows Subsystem for Linux</span></span>
  
   <span data-ttu-id="50732-126">在 Windows 上的 Ubuntu 上升级此部分 Bash 会启用[发行说明](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes)中的任何新的修补程序概述。</span><span class="sxs-lookup"><span data-stu-id="50732-126">Upgrading this portion of Bash on Ubuntu on Windows will enable any new fixes outlines in the [release notes](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes).</span></span> <span data-ttu-id="50732-127">确保你已订阅 Windows 预览体验计划, 并且你的生成是最新版本。</span><span class="sxs-lookup"><span data-stu-id="50732-127">Ensure that you are subscribed to the Windows Insider Program and that your build is up to date.</span></span> <span data-ttu-id="50732-128">为了获得更精细的控制, 包括重置 Ubuntu 实例, 请签出 "[命令引用" 页](https://msdn.microsoft.com/en-us/commandline/wsl/reference)。</span><span class="sxs-lookup"><span data-stu-id="50732-128">For finer grain control including resetting your Ubuntu instance check out the [command reference page](https://msdn.microsoft.com/en-us/commandline/wsl/reference).</span></span>

2. <span data-ttu-id="50732-129">Ubuntu 用户二进制文件</span><span class="sxs-lookup"><span data-stu-id="50732-129">The Ubuntu user binaries</span></span> 

   <span data-ttu-id="50732-130">在 Windows 上的 Ubuntu 上升级此部分 Bash 会将任何更新安装到 Ubuntu 用户二进制文件, 包括已通过 apt 安装的应用程序。</span><span class="sxs-lookup"><span data-stu-id="50732-130">Upgrading this portion of Bash on Ubuntu on Windows will install any updates to the Ubuntu user binaries including applications that you have installed via apt-get.</span></span> <span data-ttu-id="50732-131">若要更新, 请在 Bash 中运行以下命令:</span><span class="sxs-lookup"><span data-stu-id="50732-131">To update run the following commands in Bash:</span></span>
  
   1. `apt-get update`
   2. `apt-get upgrade`
  
### <a name="apt-get-upgrade-errors"></a><span data-ttu-id="50732-132">Apt-获取升级错误</span><span class="sxs-lookup"><span data-stu-id="50732-132">Apt-get upgrade errors</span></span>
<span data-ttu-id="50732-133">某些包使用我们尚未实现的功能。</span><span class="sxs-lookup"><span data-stu-id="50732-133">Some packages use features that we haven't implemented yet.</span></span> <span data-ttu-id="50732-134">`udev`例如, 尚不支持, 并导致几个`apt-get upgrade`错误。</span><span class="sxs-lookup"><span data-stu-id="50732-134">`udev`, for example, isn't supported yet and causes several `apt-get upgrade` errors.</span></span>

<span data-ttu-id="50732-135">若要解决与相关`udev`的问题, 请执行以下步骤:</span><span class="sxs-lookup"><span data-stu-id="50732-135">To fix issues related to `udev`, follow the following steps:</span></span>

1. <span data-ttu-id="50732-136">将以下项写入`/usr/sbin/policy-rc.d`到中, 并保存所做的更改。</span><span class="sxs-lookup"><span data-stu-id="50732-136">Write the following to `/usr/sbin/policy-rc.d` and save your changes.</span></span>
  
   ``` BASH
   #!/bin/sh
   exit 101
   ```
  
2. <span data-ttu-id="50732-137">向添加执行权限`/usr/sbin/policy-rc.d`</span><span class="sxs-lookup"><span data-stu-id="50732-137">Add execute permissions to `/usr/sbin/policy-rc.d`</span></span>
   ``` BASH
   chmod +x /usr/sbin/policy-rc.d
   ```
  
3. <span data-ttu-id="50732-138">运行以下命令</span><span class="sxs-lookup"><span data-stu-id="50732-138">Run the following commands</span></span>
   ``` BASH
   dpkg-divert --local --rename --add /sbin/initctl
   ln -s /bin/true /sbin/initctl
   ```
  
### <a name="error-0x80040306-on-installation"></a><span data-ttu-id="50732-139">条0x80040306 "安装时</span><span class="sxs-lookup"><span data-stu-id="50732-139">"Error: 0x80040306" on installation</span></span>
<span data-ttu-id="50732-140">这与我们不支持旧版控制台这一事实有关。</span><span class="sxs-lookup"><span data-stu-id="50732-140">This has to do with the fact that we do not support legacy console.</span></span>
<span data-ttu-id="50732-141">关闭旧版控制台:</span><span class="sxs-lookup"><span data-stu-id="50732-141">To turn off legacy console:</span></span>

1. <span data-ttu-id="50732-142">打开 cmd.exe</span><span class="sxs-lookup"><span data-stu-id="50732-142">Open cmd.exe</span></span>
1. <span data-ttu-id="50732-143">右键单击标题栏-> 属性-> 取消选中 "使用旧版控制台"</span><span class="sxs-lookup"><span data-stu-id="50732-143">Right click title bar -> Properties -> Uncheck Use legacy console</span></span>
1. <span data-ttu-id="50732-144">单击“确定”</span><span class="sxs-lookup"><span data-stu-id="50732-144">Click OK</span></span>

### <a name="error-0x80040154-after-windows-update"></a><span data-ttu-id="50732-145">条0x80040154 "Windows 更新后</span><span class="sxs-lookup"><span data-stu-id="50732-145">"Error: 0x80040154" after Windows update</span></span>
<span data-ttu-id="50732-146">Windows 更新时, 适用于 Linux 的 Windows 子系统功能可能处于禁用状态。</span><span class="sxs-lookup"><span data-stu-id="50732-146">The Windows Subsystem for Linux feature may be disabled during a Windows update.</span></span> <span data-ttu-id="50732-147">如果出现这种情况, 则必须重新启用 Windows 功能。</span><span class="sxs-lookup"><span data-stu-id="50732-147">If this happens the Windows feature must be re-enabled.</span></span> <span data-ttu-id="50732-148">有关启用适用于 Linux 的 Windows 子系统的说明, 请参阅[安装指南](https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui)。</span><span class="sxs-lookup"><span data-stu-id="50732-148">Instructions for enabling the Windows Subsystem for Linux can be found in the [Installation Guide](https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-guihttps://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui).</span></span>

### <a name="changing-the-display-language"></a><span data-ttu-id="50732-149">更改显示语言</span><span class="sxs-lookup"><span data-stu-id="50732-149">Changing the display language</span></span>
<span data-ttu-id="50732-150">WSL 安装将尝试自动更改 Ubuntu 区域设置以与 Windows 安装的区域设置相匹配。</span><span class="sxs-lookup"><span data-stu-id="50732-150">WSL install will try to automatically change the Ubuntu locale to match the locale of your Windows install.</span></span>  <span data-ttu-id="50732-151">如果不想要此行为, 可以在安装完成后运行此命令来更改 Ubuntu 区域设置。</span><span class="sxs-lookup"><span data-stu-id="50732-151">If you do not want this behavior you can run this command to change the Ubuntu locale after install completes.</span></span>  <span data-ttu-id="50732-152">要使此更改生效, 您必须重新启动 bash。</span><span class="sxs-lookup"><span data-stu-id="50732-152">You will have to relaunch bash.exe for this change to take effect.</span></span>

<span data-ttu-id="50732-153">下面的示例将区域设置更改为 en-us:</span><span class="sxs-lookup"><span data-stu-id="50732-153">The below example changes to locale to en-US:</span></span>
``` BASH
sudo update-locale LANG=en_US.UTF8
```

### <a name="installation-issues-after-windows-system-restore"></a><span data-ttu-id="50732-154">Windows 系统还原后的安装问题</span><span class="sxs-lookup"><span data-stu-id="50732-154">Installation issues after Windows system restore</span></span>
1.  <span data-ttu-id="50732-155">删除该`%windir%\System32\Tasks\Microsoft\Windows\Windows Subsystem for Linux`文件夹。</span><span class="sxs-lookup"><span data-stu-id="50732-155">Delete the `%windir%\System32\Tasks\Microsoft\Windows\Windows Subsystem for Linux` folder.</span></span> <br/>
  <span data-ttu-id="50732-156">**注意：如果可选功能已完全安装并且工作正常, 请不要执行此操作。**</span><span class="sxs-lookup"><span data-stu-id="50732-156">**Note: Do not do this if your optional feature is fully installed and working.**</span></span>
2.  <span data-ttu-id="50732-157">启用 WSL 可选功能 (如果尚未这样做)</span><span class="sxs-lookup"><span data-stu-id="50732-157">Enable the WSL optional feature (if not already)</span></span>
3.  <span data-ttu-id="50732-158">重新启动</span><span class="sxs-lookup"><span data-stu-id="50732-158">Reboot</span></span>
4.  <span data-ttu-id="50732-159">lxrun/uninstall/full</span><span class="sxs-lookup"><span data-stu-id="50732-159">lxrun /uninstall /full</span></span>
5.  <span data-ttu-id="50732-160">安装 bash</span><span class="sxs-lookup"><span data-stu-id="50732-160">Install bash</span></span>

### <a name="no-internet-access-in-wsl"></a><span data-ttu-id="50732-161">WSL 中无 internet 访问权限</span><span class="sxs-lookup"><span data-stu-id="50732-161">No internet access in WSL</span></span>
<span data-ttu-id="50732-162">某些用户已报告在 WSL 中阻止 internet 访问的特定防火墙应用程序的问题。</span><span class="sxs-lookup"><span data-stu-id="50732-162">Some users have reported issues with specific firewall applications blocking internet access in WSL.</span></span>  <span data-ttu-id="50732-163">报告的防火墙包括:</span><span class="sxs-lookup"><span data-stu-id="50732-163">The firewalls reported are:</span></span>

1. <span data-ttu-id="50732-164">Kaspersky 等</span><span class="sxs-lookup"><span data-stu-id="50732-164">Kaspersky</span></span>
1. <span data-ttu-id="50732-165">AVG</span><span class="sxs-lookup"><span data-stu-id="50732-165">AVG</span></span>
1. <span data-ttu-id="50732-166">Avast</span><span class="sxs-lookup"><span data-stu-id="50732-166">Avast</span></span>

<span data-ttu-id="50732-167">在某些情况下, 关闭防火墙允许进行访问。</span><span class="sxs-lookup"><span data-stu-id="50732-167">In some cases turning off the firewall allows for access.</span></span>  <span data-ttu-id="50732-168">在某些情况下, 只需安装防火墙即可阻止访问。</span><span class="sxs-lookup"><span data-stu-id="50732-168">In some cases simply having the firewall installed looks to block access.</span></span>

### <a name="permission-denied-error-when-using-ping"></a><span data-ttu-id="50732-169">使用 ping 时权限被拒绝错误</span><span class="sxs-lookup"><span data-stu-id="50732-169">Permission Denied error when using ping</span></span>
#### <a name="anniversary-updatehttpsmsdnmicrosoftcomen-uscommandlinewslrelease_notesbuild-14388-to-windows-10-anniversary-update"></a>[<span data-ttu-id="50732-170">周年更新</span><span class="sxs-lookup"><span data-stu-id="50732-170">Anniversary Update</span></span>](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14388-to-windows-10-anniversary-update) 

<span data-ttu-id="50732-171">Windows 中的管理员权限需要在 WSL 中运行 ping。</span><span class="sxs-lookup"><span data-stu-id="50732-171">Administrator privileges in Windows are required to run ping in WSL.</span></span>  <span data-ttu-id="50732-172">若要运行 ping, 请在 Windows 上的 Ubuntu 上以管理员身份运行 Bash, 或从具有管理员权限的 CMD/PowerShell 提示符运行 bash。</span><span class="sxs-lookup"><span data-stu-id="50732-172">To run ping, run Bash on Ubuntu on Windows as an administrator, or run bash.exe from a CMD/PowerShell prompt with administrator privileges.</span></span>

#### <a name="build-14926httpsmsdnmicrosoftcomen-uscommandlinewslrelease_notesbuild-14926"></a>[<span data-ttu-id="50732-173">生成 14926 +</span><span class="sxs-lookup"><span data-stu-id="50732-173">Build 14926+</span></span>](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14926)
  <span data-ttu-id="50732-174">不再需要管理员权限。</span><span class="sxs-lookup"><span data-stu-id="50732-174">Administrator privileges no longer required.</span></span>

### <a name="bash-is-hung"></a><span data-ttu-id="50732-175">Bash 挂起</span><span class="sxs-lookup"><span data-stu-id="50732-175">Bash is hung</span></span>
<span data-ttu-id="50732-176">如果使用 bash, 你会发现 bash 挂起 (或死锁), 不响应输入, 请通过收集和报告内存转储来帮助我们诊断问题。</span><span class="sxs-lookup"><span data-stu-id="50732-176">If while working with bash, you find that bash is hung (or deadlocked) and not responding to inputs, help us diagnose the issue by collecting and reporting a memory dump.</span></span> <span data-ttu-id="50732-177">请注意, 这些步骤会使你的系统崩溃。</span><span class="sxs-lookup"><span data-stu-id="50732-177">Note that these steps will crash your system.</span></span> <span data-ttu-id="50732-178">如果您不熟悉此操作或在执行此操作之前保存您的工作, 请不要这样做。</span><span class="sxs-lookup"><span data-stu-id="50732-178">Do not do this if you are not comfortable with that or save your work prior to doing this.</span></span>  <br/>
<span data-ttu-id="50732-179">收集内存转储:</span><span class="sxs-lookup"><span data-stu-id="50732-179">To collect a memory dump:</span></span>
1. <span data-ttu-id="50732-180">将内存转储类型更改为 "完成内存转储"。</span><span class="sxs-lookup"><span data-stu-id="50732-180">Change the memory dump type to "complete memory dump".</span></span> <span data-ttu-id="50732-181">更改转储类型时, 请记下当前类型。</span><span class="sxs-lookup"><span data-stu-id="50732-181">While changing the dump type, take a note of your current type.</span></span>
2. <span data-ttu-id="50732-182">使用键盘控制[步骤](https://blogs.technet.microsoft.com/askpfeplat/2015/04/05/how-to-force-a-diagnostic-memory-dump-when-a-computer-hangs/)来配置故障。</span><span class="sxs-lookup"><span data-stu-id="50732-182">Use the [steps](https://blogs.technet.microsoft.com/askpfeplat/2015/04/05/how-to-force-a-diagnostic-memory-dump-when-a-computer-hangs/) to configure crash using keyboard control.</span></span>
3. <span data-ttu-id="50732-183">重现挂起或死锁。</span><span class="sxs-lookup"><span data-stu-id="50732-183">Repro the hang or deadlock.</span></span>
4. <span data-ttu-id="50732-184">使用 (2) 中的密钥序列来崩溃系统。</span><span class="sxs-lookup"><span data-stu-id="50732-184">Crash the system using the key sequence from (2).</span></span>
5. <span data-ttu-id="50732-185">系统将崩溃并收集内存转储。</span><span class="sxs-lookup"><span data-stu-id="50732-185">The system will crash and collect the memory dump.</span></span>
6. <span data-ttu-id="50732-186">系统重新启动后, 会将 dmp 报告给secure@microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="50732-186">Once the system reboots, report the memory.dmp to secure@microsoft.com.</span></span> <span data-ttu-id="50732-187">转储文件的默认位置是%SystemRoot%\memory.dmp 或 C:\Windows\memory.dmp (如果 C: 是系统驱动器)。</span><span class="sxs-lookup"><span data-stu-id="50732-187">The default location of the dump file is %SystemRoot%\memory.dmp or C:\Windows\memory.dmp if C: is the system drive.</span></span> <span data-ttu-id="50732-188">请注意, 在电子邮件中, 此转储适用于 Windows 团队上的 WSL 或 Bash。</span><span class="sxs-lookup"><span data-stu-id="50732-188">In the email, note that the dump is for the WSL or Bash on Windows team.</span></span>
7. <span data-ttu-id="50732-189">将内存转储类型还原为原始设置。</span><span class="sxs-lookup"><span data-stu-id="50732-189">Restore the memory dump type to the original setting.</span></span>

### <a name="check-your-build-number"></a><span data-ttu-id="50732-190">检查生成号</span><span class="sxs-lookup"><span data-stu-id="50732-190">Check your build number</span></span>

<span data-ttu-id="50732-191">若要查找你的电脑体系结构和 Windows 内部版本号, 请打开</span><span class="sxs-lookup"><span data-stu-id="50732-191">To find your PC's architecture and Windows build number, open</span></span>  
<span data-ttu-id="50732-192">**设置** > **系统**有关 > </span><span class="sxs-lookup"><span data-stu-id="50732-192">**Settings** > **System** > **About**</span></span>

<span data-ttu-id="50732-193">查找 "**操作系统生成**" 和 "**系统类型**" 字段。</span><span class="sxs-lookup"><span data-stu-id="50732-193">Look for the **OS Build** and **System Type** fields.</span></span>  
    <span data-ttu-id="50732-194">!["生成" 和 "系统类型" 字段的屏幕截图](media/system.png)</span><span class="sxs-lookup"><span data-stu-id="50732-194">![Screenshot of Build and System Type fields](media/system.png)</span></span> 


<span data-ttu-id="50732-195">若要查找 Windows Server 内部版本号, 请在 PowerShell 中运行以下内容:</span><span class="sxs-lookup"><span data-stu-id="50732-195">To find your Windows Server build number, run the following in PowerShell:</span></span>  
``` PowerShell
systeminfo | Select-String "^OS Name","^OS Version"
```

### <a name="confirm-wsl-is-enabled"></a><span data-ttu-id="50732-196">确认 WSL 已启用</span><span class="sxs-lookup"><span data-stu-id="50732-196">Confirm WSL is enabled</span></span>
<span data-ttu-id="50732-197">可以通过在 PowerShell 中运行以下内容来确认是否已启用适用于 Linux 的 Windows 子系统:</span><span class="sxs-lookup"><span data-stu-id="50732-197">You can confirm that the Windows Subsystem for Linux is enabled by running the following in PowerShell:</span></span>  
``` PowerShell
Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

### <a name="openssh-server-connection-issues"></a><span data-ttu-id="50732-198">OpenSSH-服务器连接问题</span><span class="sxs-lookup"><span data-stu-id="50732-198">OpenSSH-Server connection issues</span></span>
<span data-ttu-id="50732-199">尝试连接 SSH 服务器失败, 出现以下错误:"连接被127.0.0.1 端口22关闭"。</span><span class="sxs-lookup"><span data-stu-id="50732-199">Trying to connect your SSH server is failed with the following error: "Connection closed by 127.0.0.1 port 22".</span></span>
1. <span data-ttu-id="50732-200">请确保 OpenSSH 服务器正在运行:</span><span class="sxs-lookup"><span data-stu-id="50732-200">Make sure your OpenSSH Server is running:</span></span>
   ``` BASH
   sudo service ssh status
   ```
   <span data-ttu-id="50732-201">你已按照本教程进行操作: https://help.ubuntu.com/lts/serverguide/openssh-server.html.en</span><span class="sxs-lookup"><span data-stu-id="50732-201">and you've followed this tutorial: https://help.ubuntu.com/lts/serverguide/openssh-server.html.en</span></span>
2. <span data-ttu-id="50732-202">停止 sshd 服务并在调试模式下启动 sshd:</span><span class="sxs-lookup"><span data-stu-id="50732-202">Stop the sshd service and start sshd in debug mode:</span></span>
   ``` BASH
   sudo service ssh stop
   sudo /usr/sbin/sshd -d
   ```
3. <span data-ttu-id="50732-203">检查启动日志并确保 HostKeys 可用, 并且看不到日志消息, 如:</span><span class="sxs-lookup"><span data-stu-id="50732-203">Check the startup logs and make sure HostKeys are available and you don't see log messages such as:</span></span>
   ```
   debug1: sshd version OpenSSH_7.2, OpenSSL 1.0.2g  1 Mar 2016
   debug1: key_load_private: incorrect passphrase supplied to decrypt private key
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_rsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_dsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_ecdsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_ed25519_key
   ```

<span data-ttu-id="50732-204">如果看不到下面`/etc/ssh/`这样的消息, 则需要重新生成密钥, 或者只是清除 & 安装 openssh-服务器:</span><span class="sxs-lookup"><span data-stu-id="50732-204">If you do see such messages and the keys are missing under `/etc/ssh/`, you will have to regenerate the keys or just purge&install openssh-server:</span></span>
```BASH
sudo apt-get purge openssh-server
sudo apt-get install openssh-server
```

