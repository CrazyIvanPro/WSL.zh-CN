---
title: 适用于 Linux 的疑难解答 Windows Susbystem
description: 提供有关常见的错误详细的信息和发出到运行的人在适用于 Linux 上 Windows Susbystem 运行 Linux 时。
keywords: BashOnWindows，bash、 wsl、 windows、 windowssubsystem、 ubuntu
author: scooley
ms.author: scooley
ms.date: 11/15/2017
ms.topic: article
ms.assetid: 6753f1b2-200e-49cc-93a5-4323e1117246
ms.custom: seodec18
ms.openlocfilehash: 055bdc02dcf8f078caa014abd6dd755a47c99cfe
ms.sourcegitcommit: ca08a78925880ed3eccf88edb30def16c83f2543
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/04/2019
ms.locfileid: "59063295"
---
# <a name="troubleshooting-windows-subsystem-for-linux"></a><span data-ttu-id="1a976-104">适用于 Linux 的故障排除 Windows 子系统</span><span class="sxs-lookup"><span data-stu-id="1a976-104">Troubleshooting Windows Subsystem for Linux</span></span>

### <a name="bash-loses-network-connectivity-once-connected-to-a-vpn"></a><span data-ttu-id="1a976-105">Bash 一次连接到 VPN 的网络连接丢失</span><span class="sxs-lookup"><span data-stu-id="1a976-105">Bash loses network connectivity once connected to a VPN</span></span>

<span data-ttu-id="1a976-106">如果连接到在 Windows 上的 VPN 后，bash 丢失网络连接性，请尝试从 bash 中的此解决方法。</span><span class="sxs-lookup"><span data-stu-id="1a976-106">If after connecting to a VPN on Windows, bash loses network connectivity, try this workaround from within bash.</span></span> <span data-ttu-id="1a976-107">此解决方法便可以手动重写通过 DNS 解析`/etc/resolv.conf`。</span><span class="sxs-lookup"><span data-stu-id="1a976-107">This workaround will allow you to manually override the DNS resolution through `/etc/resolv.conf`.</span></span>

1. <span data-ttu-id="1a976-108">记下与执行 VPN 的 DNS 服务器</span><span class="sxs-lookup"><span data-stu-id="1a976-108">Take a note of the DNS server of the VPN from doing</span></span> `ipconfig.exe /all`
2. <span data-ttu-id="1a976-109">制作一份现有 resolv.conf `sudo cp /etc/resolv.conf /etc/resolv.conf.new`</span><span class="sxs-lookup"><span data-stu-id="1a976-109">Make a copy of the existing resolv.conf `sudo cp /etc/resolv.conf /etc/resolv.conf.new`</span></span>
3. <span data-ttu-id="1a976-110">取消链接当前 resolv.con `sudo unlink /etc/resolv.conf`</span><span class="sxs-lookup"><span data-stu-id="1a976-110">Unlink the current resolv.con `sudo unlink /etc/resolv.conf`</span></span>
4. `sudo mv /etc/resolv.conf.new /etc/resolv.conf`
5. <span data-ttu-id="1a976-111">打开`/etc/resolv.conf`和</span><span class="sxs-lookup"><span data-stu-id="1a976-111">Open `/etc/resolv.conf` and</span></span> <br/>
   <span data-ttu-id="1a976-112">a.</span><span class="sxs-lookup"><span data-stu-id="1a976-112">a.</span></span> <span data-ttu-id="1a976-113">从该文件，这表示删除的第一行"\# WSL 由自动生成此文件。</span><span class="sxs-lookup"><span data-stu-id="1a976-113">Delete the first line from the file, which says "\# This file was automatically generated by WSL.</span></span> <span data-ttu-id="1a976-114">若要停止自动生成此文件，请删除此行。"。</span><span class="sxs-lookup"><span data-stu-id="1a976-114">To stop automatic generation of this file, remove this line.".</span></span> <br/>
   <span data-ttu-id="1a976-115">b.</span><span class="sxs-lookup"><span data-stu-id="1a976-115">b.</span></span> <span data-ttu-id="1a976-116">DNS 服务器列表中的第一个条目，可将 DNS 条目 (1) 添加上面。</span><span class="sxs-lookup"><span data-stu-id="1a976-116">Add the DNS entry from (1) above as the very first entry in the list of DNS servers.</span></span> <br/>
   <span data-ttu-id="1a976-117">c.</span><span class="sxs-lookup"><span data-stu-id="1a976-117">c.</span></span> <span data-ttu-id="1a976-118">关闭该文件。</span><span class="sxs-lookup"><span data-stu-id="1a976-118">Close the file.</span></span> <br/>

<span data-ttu-id="1a976-119">后已断开连接 VPN，你将需要还原到的更改`/etc/resolv.conf`。</span><span class="sxs-lookup"><span data-stu-id="1a976-119">Once you have disconnected the VPN, you will have to revert the changes to `/etc/resolv.conf`.</span></span> <span data-ttu-id="1a976-120">若要执行此操作，请执行：</span><span class="sxs-lookup"><span data-stu-id="1a976-120">To do this, do:</span></span>
1. `cd /etc`
2. `sudo mv resolv.conf resolv.conf.new`
3. `sudo ln -s ../run/resolvconf/resolv.conf resolv.conf`

### <a name="starting-wsl-or-installing-a-distribution-returns-an-error-code"></a><span data-ttu-id="1a976-121">启动 WSL 或安装分发将返回错误代码</span><span class="sxs-lookup"><span data-stu-id="1a976-121">Starting WSL or installing a distribution returns an error code</span></span>

<span data-ttu-id="1a976-122">请按照[这些说明](https://github.com/Microsoft/WSL/blob/master/CONTRIBUTING.md#8-detailed-logs)收集详细的日志并在 GitHub 上提出问题。</span><span class="sxs-lookup"><span data-stu-id="1a976-122">Follow [these instructions](https://github.com/Microsoft/WSL/blob/master/CONTRIBUTING.md#8-detailed-logs) to collect detailed logs and file an issue on our GitHub.</span></span>

### <a name="updating-bash-on-ubuntu-on-windows"></a><span data-ttu-id="1a976-123">正在更新 Bash on Ubuntu 上 Windows</span><span class="sxs-lookup"><span data-stu-id="1a976-123">Updating Bash on Ubuntu on Windows</span></span>

<span data-ttu-id="1a976-124">有两个组件的 Bash on Ubuntu 上可能需要更新的 Windows。</span><span class="sxs-lookup"><span data-stu-id="1a976-124">There are two components of Bash on Ubuntu on Windows that can require updating.</span></span> 

1. <span data-ttu-id="1a976-125">适用于 Linux 的 Windows 子系统</span><span class="sxs-lookup"><span data-stu-id="1a976-125">The Windows Subsystem for Linux</span></span>
  
   <span data-ttu-id="1a976-126">升级 Bash on Ubuntu 上 Windows 的此部分将启用在任何新的修补程序大纲[发行说明](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes)。</span><span class="sxs-lookup"><span data-stu-id="1a976-126">Upgrading this portion of Bash on Ubuntu on Windows will enable any new fixes outlines in the [release notes](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes).</span></span> <span data-ttu-id="1a976-127">请确保你已订阅 Windows 预览体验计划以及你的生成是最新。</span><span class="sxs-lookup"><span data-stu-id="1a976-127">Ensure that you are subscribed to the Windows Insider Program and that your build is up to date.</span></span> <span data-ttu-id="1a976-128">对于更细粒度控制，包括重置你的 Ubuntu 实例签出[命令参考页](https://msdn.microsoft.com/en-us/commandline/wsl/reference)。</span><span class="sxs-lookup"><span data-stu-id="1a976-128">For finer grain control including resetting your Ubuntu instance check out the [command reference page](https://msdn.microsoft.com/en-us/commandline/wsl/reference).</span></span>

2. <span data-ttu-id="1a976-129">Ubuntu 用户二进制文件</span><span class="sxs-lookup"><span data-stu-id="1a976-129">The Ubuntu user binaries</span></span> 

   <span data-ttu-id="1a976-130">升级 Bash on Ubuntu 上 Windows 的此部分将安装到 Ubuntu 用户二进制文件包括已通过 apt-get 安装的应用程序的任何更新。</span><span class="sxs-lookup"><span data-stu-id="1a976-130">Upgrading this portion of Bash on Ubuntu on Windows will install any updates to the Ubuntu user binaries including applications that you have installed via apt-get.</span></span> <span data-ttu-id="1a976-131">若要更新运行以下命令在 Bash 中：</span><span class="sxs-lookup"><span data-stu-id="1a976-131">To update run the following commands in Bash:</span></span>
  
   1. `apt-get update`
   2. `apt-get upgrade`
  
### <a name="apt-get-upgrade-errors"></a><span data-ttu-id="1a976-132">Pt-get 升级错误</span><span class="sxs-lookup"><span data-stu-id="1a976-132">Apt-get upgrade errors</span></span>
<span data-ttu-id="1a976-133">某些包使用我们尚未实现的功能。</span><span class="sxs-lookup"><span data-stu-id="1a976-133">Some packages use features that we haven't implemented yet.</span></span> `udev`<span data-ttu-id="1a976-134">例如，尚不支持并导致多`apt-get upgrade`错误。</span><span class="sxs-lookup"><span data-stu-id="1a976-134">, for example, isn't supported yet and causes several `apt-get upgrade` errors.</span></span>

<span data-ttu-id="1a976-135">若要修复与相关的问题`udev`，请执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="1a976-135">To fix issues related to `udev`, follow the following steps:</span></span>

1. <span data-ttu-id="1a976-136">写入到以下`/usr/sbin/policy-rc.d`并保存所做的更改。</span><span class="sxs-lookup"><span data-stu-id="1a976-136">Write the following to `/usr/sbin/policy-rc.d` and save your changes.</span></span>
  
   ``` BASH
   #!/bin/sh
   exit 101
   ```
  
2. <span data-ttu-id="1a976-137">添加将执行权限</span><span class="sxs-lookup"><span data-stu-id="1a976-137">Add execute permissions to</span></span> `/usr/sbin/policy-rc.d`
   ``` BASH
   chmod +x /usr/sbin/policy-rc.d
   ```
  
3. <span data-ttu-id="1a976-138">运行以下命令</span><span class="sxs-lookup"><span data-stu-id="1a976-138">Run the following commands</span></span>
   ``` BASH
   dpkg-divert --local --rename --add /sbin/initctl
   ln -s /bin/true /sbin/initctl
   ```
  
### <a name="error-0x80040306-on-installation"></a><span data-ttu-id="1a976-139">"错误：0x80040306"上安装</span><span class="sxs-lookup"><span data-stu-id="1a976-139">"Error: 0x80040306" on installation</span></span>
<span data-ttu-id="1a976-140">这都只需这一事实，我们不支持旧版控制台。</span><span class="sxs-lookup"><span data-stu-id="1a976-140">This has to do with the fact that we do not support legacy console.</span></span>
<span data-ttu-id="1a976-141">若要关闭旧版控制台：</span><span class="sxs-lookup"><span data-stu-id="1a976-141">To turn off legacy console:</span></span>

1. <span data-ttu-id="1a976-142">打开 cmd.exe</span><span class="sxs-lookup"><span data-stu-id="1a976-142">Open cmd.exe</span></span>
1. <span data-ttu-id="1a976-143">右键单击标题栏-> 属性-> 取消选中使用传统控制台</span><span class="sxs-lookup"><span data-stu-id="1a976-143">Right click title bar -> Properties -> Uncheck Use legacy console</span></span>
1. <span data-ttu-id="1a976-144">单击“确定”</span><span class="sxs-lookup"><span data-stu-id="1a976-144">Click OK</span></span>

### <a name="error-0x80040154-after-windows-update"></a><span data-ttu-id="1a976-145">"错误：0x80040154"Windows 更新后</span><span class="sxs-lookup"><span data-stu-id="1a976-145">"Error: 0x80040154" after Windows update</span></span>
<span data-ttu-id="1a976-146">Linux 功能的 Windows 子系统可能会禁用在 Windows 更新过程。</span><span class="sxs-lookup"><span data-stu-id="1a976-146">The Windows Subsystem for Linux feature may be disabled during a Windows update.</span></span> <span data-ttu-id="1a976-147">如果发生这种情况必须在重新启用 Windows 功能。</span><span class="sxs-lookup"><span data-stu-id="1a976-147">If this happens the Windows feature must be re-enabled.</span></span> <span data-ttu-id="1a976-148">有关启用 Windows 子系统，Linux 可查找中的说明[安装指南](https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui)。</span><span class="sxs-lookup"><span data-stu-id="1a976-148">Instructions for enabling the Windows Subsystem for Linux can be found in the [Installation Guide](https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-guihttps://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui).</span></span>

### <a name="changing-the-display-language"></a><span data-ttu-id="1a976-149">更改显示语言</span><span class="sxs-lookup"><span data-stu-id="1a976-149">Changing the display language</span></span>
<span data-ttu-id="1a976-150">WSL 安装将尝试自动更改 Ubuntu 区域设置，以便与 Windows 安装程序的区域设置匹配。</span><span class="sxs-lookup"><span data-stu-id="1a976-150">WSL install will try to automatically change the Ubuntu locale to match the locale of your Windows install.</span></span>  <span data-ttu-id="1a976-151">如果您不需要此行为可以运行此命令以安装完成后更改 Ubuntu 区域设置。</span><span class="sxs-lookup"><span data-stu-id="1a976-151">If you do not want this behavior you can run this command to change the Ubuntu locale after install completes.</span></span>  <span data-ttu-id="1a976-152">必须重新启动 bash.exe 此更改才会生效。</span><span class="sxs-lookup"><span data-stu-id="1a976-152">You will have to relaunch bash.exe for this change to take effect.</span></span>

<span data-ttu-id="1a976-153">下面的示例更改为 EN-US 区域设置：</span><span class="sxs-lookup"><span data-stu-id="1a976-153">The below example changes to locale to en-US:</span></span>
``` BASH
sudo update-locale LANG=en_US.UTF8
```

### <a name="installation-issues-after-windows-system-restore"></a><span data-ttu-id="1a976-154">Windows 系统还原后的安装问题</span><span class="sxs-lookup"><span data-stu-id="1a976-154">Installation issues after Windows system restore</span></span>
1.  <span data-ttu-id="1a976-155">删除`%windir%\System32\Tasks\Microsoft\Windows\Windows Subsystem for Linux`文件夹。</span><span class="sxs-lookup"><span data-stu-id="1a976-155">Delete the `%windir%\System32\Tasks\Microsoft\Windows\Windows Subsystem for Linux` folder.</span></span> <br/>
  **<span data-ttu-id="1a976-156">注意：不这样做如果完全安装可选功能和工作正常。</span><span class="sxs-lookup"><span data-stu-id="1a976-156">Note: Do not do this if your optional feature is fully installed and working.</span></span>**
2.  <span data-ttu-id="1a976-157">启用 WSL 可选功能 （如果尚不存在）</span><span class="sxs-lookup"><span data-stu-id="1a976-157">Enable the WSL optional feature (if not already)</span></span>
3.  <span data-ttu-id="1a976-158">重新启动</span><span class="sxs-lookup"><span data-stu-id="1a976-158">Reboot</span></span>
4.  <span data-ttu-id="1a976-159">lxrun / 卸载 / 完整</span><span class="sxs-lookup"><span data-stu-id="1a976-159">lxrun /uninstall /full</span></span>
5.  <span data-ttu-id="1a976-160">安装 bash</span><span class="sxs-lookup"><span data-stu-id="1a976-160">Install bash</span></span>

### <a name="no-internet-access-in-wsl"></a><span data-ttu-id="1a976-161">在 WSL 中没有 internet 访问</span><span class="sxs-lookup"><span data-stu-id="1a976-161">No internet access in WSL</span></span>
<span data-ttu-id="1a976-162">某些用户与特定的防火墙应用程序阻止 internet 访问在 WSL 中的报告的问题。</span><span class="sxs-lookup"><span data-stu-id="1a976-162">Some users have reported issues with specific firewall applications blocking internet access in WSL.</span></span>  <span data-ttu-id="1a976-163">防火墙报告是：</span><span class="sxs-lookup"><span data-stu-id="1a976-163">The firewalls reported are:</span></span>

1. <span data-ttu-id="1a976-164">Kaspersky</span><span class="sxs-lookup"><span data-stu-id="1a976-164">Kaspersky</span></span>
1. <span data-ttu-id="1a976-165">AVG</span><span class="sxs-lookup"><span data-stu-id="1a976-165">AVG</span></span>
1. <span data-ttu-id="1a976-166">Avast</span><span class="sxs-lookup"><span data-stu-id="1a976-166">Avast</span></span>

<span data-ttu-id="1a976-167">在某些情况下关闭防火墙允许访问。</span><span class="sxs-lookup"><span data-stu-id="1a976-167">In some cases turning off the firewall allows for access.</span></span>  <span data-ttu-id="1a976-168">只需时安装防火墙的某些情况下看起来以阻止访问。</span><span class="sxs-lookup"><span data-stu-id="1a976-168">In some cases simply having the firewall installed looks to block access.</span></span>

### <a name="permission-denied-error-when-using-ping"></a><span data-ttu-id="1a976-169">使用 ping 时权限被拒绝错误</span><span class="sxs-lookup"><span data-stu-id="1a976-169">Permission Denied error when using ping</span></span>
#### [<a name="anniversary-update"></a><span data-ttu-id="1a976-170">周年更新</span><span class="sxs-lookup"><span data-stu-id="1a976-170">Anniversary Update</span></span>](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14388-to-windows-10-anniversary-update) 

<span data-ttu-id="1a976-171">在 Windows 中的管理员权限才可在 WSL 中运行 ping。</span><span class="sxs-lookup"><span data-stu-id="1a976-171">Administrator privileges in Windows are required to run ping in WSL.</span></span>  <span data-ttu-id="1a976-172">若要运行 ping，以管理员身份，Windows 上运行 Ubuntu 上的 Bash 或 CMD/PowerShell 提示符下使用管理员特权运行 bash.exe。</span><span class="sxs-lookup"><span data-stu-id="1a976-172">To run ping, run Bash on Ubuntu on Windows as an administrator, or run bash.exe from a CMD/PowerShell prompt with administrator privileges.</span></span>

#### [<a name="build-14926"></a><span data-ttu-id="1a976-173">生成 14926 +</span><span class="sxs-lookup"><span data-stu-id="1a976-173">Build 14926+</span></span>](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14926)
  <span data-ttu-id="1a976-174">不再需要管理员特权。</span><span class="sxs-lookup"><span data-stu-id="1a976-174">Administrator privileges no longer required.</span></span>

### <a name="bash-is-hung"></a><span data-ttu-id="1a976-175">挂起 bash</span><span class="sxs-lookup"><span data-stu-id="1a976-175">Bash is hung</span></span>
<span data-ttu-id="1a976-176">如果同时使用 bash，发现挂起 （或发生死锁） 的 bash 并不响应输入，帮助我们诊断此问题，通过收集和报告的内存转储。</span><span class="sxs-lookup"><span data-stu-id="1a976-176">If while working with bash, you find that bash is hung (or deadlocked) and not responding to inputs, help us diagnose the issue by collecting and reporting a memory dump.</span></span> <span data-ttu-id="1a976-177">请注意这些步骤将会使系统崩溃。</span><span class="sxs-lookup"><span data-stu-id="1a976-177">Note that these steps will crash your system.</span></span> <span data-ttu-id="1a976-178">如果不熟悉，或者执行此操作之前保存工作，则请执行此操作。</span><span class="sxs-lookup"><span data-stu-id="1a976-178">Do not do this if you are not comfortable with that or save your work prior to doing this.</span></span>  <br/>
<span data-ttu-id="1a976-179">收集内存转储：</span><span class="sxs-lookup"><span data-stu-id="1a976-179">To collect a memory dump:</span></span>
1. <span data-ttu-id="1a976-180">将内存转储类型更改为"完全内存转储"。</span><span class="sxs-lookup"><span data-stu-id="1a976-180">Change the memory dump type to "complete memory dump".</span></span> <span data-ttu-id="1a976-181">更改时转储类型，记下你当前的类型。</span><span class="sxs-lookup"><span data-stu-id="1a976-181">While changing the dump type, take a note of your current type.</span></span>
2. <span data-ttu-id="1a976-182">使用[步骤](https://blogs.technet.microsoft.com/askpfeplat/2015/04/05/how-to-force-a-diagnostic-memory-dump-when-a-computer-hangs/)配置故障使用键盘控制。</span><span class="sxs-lookup"><span data-stu-id="1a976-182">Use the [steps](https://blogs.technet.microsoft.com/askpfeplat/2015/04/05/how-to-force-a-diagnostic-memory-dump-when-a-computer-hangs/) to configure crash using keyboard control.</span></span>
3. <span data-ttu-id="1a976-183">重现挂起或死锁。</span><span class="sxs-lookup"><span data-stu-id="1a976-183">Repro the hang or deadlock.</span></span>
4. <span data-ttu-id="1a976-184">使用键序列 (2) 从系统崩溃。</span><span class="sxs-lookup"><span data-stu-id="1a976-184">Crash the system using the key sequence from (2).</span></span>
5. <span data-ttu-id="1a976-185">系统将崩溃，并收集内存转储。</span><span class="sxs-lookup"><span data-stu-id="1a976-185">The system will crash and collect the memory dump.</span></span>
6. <span data-ttu-id="1a976-186">系统重启后，报告到 memory.dmp secure@microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="1a976-186">Once the system reboots, report the memory.dmp to secure@microsoft.com.</span></span> <span data-ttu-id="1a976-187">转储文件的默认位置是 %SystemRoot%\memory.dmp 或 C:\Windows\memory.dmp c： 是否在系统驱动器。</span><span class="sxs-lookup"><span data-stu-id="1a976-187">The default location of the dump file is %SystemRoot%\memory.dmp or C:\Windows\memory.dmp if C: is the system drive.</span></span> <span data-ttu-id="1a976-188">在电子邮件，请注意，转储用于 WSL 或 Bash Windows 团队。</span><span class="sxs-lookup"><span data-stu-id="1a976-188">In the email, note that the dump is for the WSL or Bash on Windows team.</span></span>
7. <span data-ttu-id="1a976-189">内存转储类型恢复为原始设置。</span><span class="sxs-lookup"><span data-stu-id="1a976-189">Restore the memory dump type to the original setting.</span></span>

### <a name="check-your-build-number"></a><span data-ttu-id="1a976-190">检查内部版本号</span><span class="sxs-lookup"><span data-stu-id="1a976-190">Check your build number</span></span>

<span data-ttu-id="1a976-191">若要查找你的电脑的体系结构和 Windows 内部版本号，请打开</span><span class="sxs-lookup"><span data-stu-id="1a976-191">To find your PC's architecture and Windows build number, open</span></span>  
<span data-ttu-id="1a976-192">**设置** > **系统** > **有关**</span><span class="sxs-lookup"><span data-stu-id="1a976-192">**Settings** > **System** > **About**</span></span>

<span data-ttu-id="1a976-193">寻找**OS 内部**并**系统类型**字段。</span><span class="sxs-lookup"><span data-stu-id="1a976-193">Look for the **OS Build** and **System Type** fields.</span></span>  
    ![生成屏幕快照和系统类型的字段](media/system.png) 


<span data-ttu-id="1a976-195">若要查找你的 Windows 服务器内部版本号，在 PowerShell 中运行以下命令：</span><span class="sxs-lookup"><span data-stu-id="1a976-195">To find your Windows Server build number, run the following in PowerShell:</span></span>  
``` PowerShell
systeminfo | Select-String "^OS Name","^OS Version"
```

### <a name="confirm-wsl-is-enabled"></a><span data-ttu-id="1a976-196">确认启用 WSL</span><span class="sxs-lookup"><span data-stu-id="1a976-196">Confirm WSL is enabled</span></span>
<span data-ttu-id="1a976-197">你可以确认，运行以下命令在 PowerShell 中启用适用于 Linux 的 Windows 子系统：</span><span class="sxs-lookup"><span data-stu-id="1a976-197">You can confirm that the Windows Subsystem for Linux is enabled by running the following in PowerShell:</span></span>  
``` PowerShell
PowerShell
Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

### <a name="openssh-server-connection-issues"></a><span data-ttu-id="1a976-198">OpenSSH 服务器连接问题</span><span class="sxs-lookup"><span data-stu-id="1a976-198">OpenSSH-Server connection issues</span></span>
<span data-ttu-id="1a976-199">尝试连接 SSH 服务器将失败，出现以下错误："连接已关闭的 127.0.0.1 端口 22"。</span><span class="sxs-lookup"><span data-stu-id="1a976-199">Trying to connect your SSH server is failed with the following error: "Connection closed by 127.0.0.1 port 22".</span></span>
1. <span data-ttu-id="1a976-200">请确保你的 OpenSSH 服务器正在运行：</span><span class="sxs-lookup"><span data-stu-id="1a976-200">Make sure your OpenSSH Server is running:</span></span>
   ``` BASH
   sudo service ssh status
   ```
   <span data-ttu-id="1a976-201">并已按照本教程中： https://help.ubuntu.com/lts/serverguide/openssh-server.html.en</span><span class="sxs-lookup"><span data-stu-id="1a976-201">and you've followed this tutorial: https://help.ubuntu.com/lts/serverguide/openssh-server.html.en</span></span>
2. <span data-ttu-id="1a976-202">停止 sshd 服务和在调试模式下启动 sshd:</span><span class="sxs-lookup"><span data-stu-id="1a976-202">Stop the sshd service and start sshd in debug mode:</span></span>
   ``` BASH
   sudo service ssh stop
   sudo /usr/sbin/sshd -d
   ```
3. <span data-ttu-id="1a976-203">检查启动日志，并确保主机密钥并且未看到日志消息，例如： debug1: sshd 版本 OpenSSH_7.2，OpenSSL 1.0.2g 1 Mar 2016 debug1: key_load_private： 不正确的通行短语提供的用于解密私有密钥 debug1: key_load_public:没有此文件或目录无法加载主机密钥： /etc/ssh/ssh_host_rsa_key debug1: key_load_private:没有此类文件或目录 debug1: key_load_public:没有此文件或目录无法加载主机密钥： /etc/ssh/ssh_host_dsa_key debug1: key_load_private:没有此类文件或目录 debug1: key_load_public:没有此文件或目录无法加载主机密钥： /etc/ssh/ssh_host_ecdsa_key debug1: key_load_private:没有此类文件或目录 debug1: key_load_public:没有此文件或目录无法加载主机密钥： /etc/ssh/ssh_host_ed25519_key</span><span class="sxs-lookup"><span data-stu-id="1a976-203">Check the startup logs and make sure HostKeys are available and you don't see log messages such as: debug1: sshd version OpenSSH_7.2, OpenSSL 1.0.2g  1 Mar 2016 debug1: key_load_private: incorrect passphrase supplied to decrypt private key debug1: key_load_public: No such file or directory Could not load host key: /etc/ssh/ssh_host_rsa_key debug1: key_load_private: No such file or directory debug1: key_load_public: No such file or directory Could not load host key: /etc/ssh/ssh_host_dsa_key debug1: key_load_private: No such file or directory debug1: key_load_public: No such file or directory Could not load host key: /etc/ssh/ssh_host_ecdsa_key debug1: key_load_private: No such file or directory debug1: key_load_public: No such file or directory Could not load host key: /etc/ssh/ssh_host_ed25519_key</span></span>

<span data-ttu-id="1a976-204">如果你看到此类消息，并且密钥由下缺少`/etc/ssh/`，您将需要重新生成密钥，或只是清除并安装 openssh 服务器：</span><span class="sxs-lookup"><span data-stu-id="1a976-204">If you do see such messages and the keys are missing under `/etc/ssh/`, you will have to regenerate the keys or just purge&install openssh-server:</span></span>
```BASH
sudo apt-get purge openssh-server
sudo apt-get install openssh-server
```

